<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>洛谷 P5811 [IOI2019] 景点划分 题解 | Sol 1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="神秘构造。">
<meta property="og:type" content="article">
<meta property="og:title" content="洛谷 P5811 [IOI2019] 景点划分 题解">
<meta property="og:url" content="http://soly5tic.github.io/2023/09/10/solution-p5811/index.html">
<meta property="og:site_name" content="Sol 1">
<meta property="og:description" content="神秘构造。">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-09-09T16:00:00.000Z">
<meta property="article:modified_time" content="2024-02-12T14:09:57.090Z">
<meta property="article:author" content="Sol 1">
<meta property="article:tag" content="题解">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Sol 1" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon_32.ico">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.0.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Sol 1</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://soly5tic.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-solution-p5811" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/09/10/solution-p5811/" class="article-date">
  <time class="dt-published" datetime="2023-09-09T16:00:00.000Z" itemprop="datePublished">2023-09-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      洛谷 P5811 [IOI2019] 景点划分 题解
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>神秘构造。</p>
<span id="more"></span>
<p>不难发现可以通过 BFS 从一个大小为 $S$ 的连通块里面提取出一个大小为 $S’\leq S$ 的连通块。于是让 $A,B,C$ 里面最大的集合不连通的方案是最容易构造的。</p>
<p>所以假设 $a\leq b\leq c$，则原题相当于要求我们将原图里面所有点划分成两个点集 $V_1,V_2$，使得 $V_1,V_2$ 的生成子图均连通，并且 $|V_1|\geq a,|V_2|\geq b$ 或者 $|V_1|\geq b,|V_2|\geq a$。</p>
<p>由于 $|V_1|+|V_2|=n$，所以最后一个条件等价于 $a\leq |V_1|\leq n-b$ 或 $b\leq |V_1|\leq n-a$。又注意到 $b\leq c&lt;n-b$，所以该条件等价于 $a\leq |V_1|\leq n-a$。</p>
<p>考虑建出原图的圆方树。那么此时，任意一个节点的子树里面所有的圆点构成的点集一定是连通的，且任意一个节点的子树外面所有的圆点构成的点集也是连通的。</p>
<p>所以如果能找到一个子树，满足其中圆点的个数在 $[a,n-a]$ 内，那么就做完了。</p>
<p>如果不能找到，也就是任意子树中圆点的个数 $&lt;a$ 或 $&gt;n-a$，则圆方树上存在一个点，以这个点为根时，它的所有子树中圆点的个数都 $&lt;a$。</p>
<p>如果这个点是一个圆点，那么说明原图中存在一个点，删去这个点以后图分为若干个大小 $&lt;a$ 的连通块。这显然是无解情况：选一个大小 $\geq a$ 的连通块就一定会选到这个割点，然后就一定无法选一个大小 $\geq b\geq a$ 的连通块。</p>
<p>如果这个点是一个方点，那么让圆方树以该点为根，设其所有孩子分别为 $u_1,u_2,\cdots,u_k$，其子树里面圆点的个数分别为 $w_{u_1},w_{u_2},\cdots,w_{u_k}$。</p>
<p>由于 $u_1,u_2,\cdots,u_k$ 构成一个点双连通分量，所以我们可以在它们之间建出一棵 DFS 树。如果这棵树上存在一个子树满足子树里面所有点的 $w$ 的和在 $[a,n-a]$ 内，那么就找到了一个合法的划分。</p>
<p>如果仍不存在，则相当于存在一个 $x$，满足 $u_x$ 的子树里面的 $w$ 的和 $&gt;n-a$ 但是 $u_x$ 的所有孩子的子树里面的 $w$ 的和 $&lt;a$。</p>
<p>但是现在我们有两个很好的性质：</p>
<ul>
<li>树是一棵 DFS 树，所以所有非树边都是返祖边。</li>
<li>原图点双连通，所以移除 $u_x$ 以后图连通。</li>
</ul>
<p>也就是说，对于任意一个 $u_x$ 的孩子 $v$，都存在一条非树边 $e$ 连接它的子树里面和 $u_x$ 的子树外面。而如果我们将树边 $(u_x,v)$ 从树里面删掉，将 $e$ 加入树，则 $v$ 的子树将会移动到 $u_x$ 的子树外面。</p>
<p>所以我们的算法流程就是找到 $u_x$，并不断将 $u_x$ 的孩子的子树移出，直到 $u_x$ 的子树里面 $w$ 的和在 $[a,n-a]$ 内。</p>
<p>注意到 $a\leq \dfrac{1}{3}n&lt; \dfrac{2}{3}n\leq n-a$，所以每次移出一个子树，$u_x$ 的子树里面 $w$ 的和减少的量 $&lt;\dfrac{1}{3}n$，因此它不能直接从一个 $&gt;\dfrac{2}{3}n$ 的值减少到一个 $&lt;\dfrac{1}{3}n$ 的值，所以一定会有一个时刻落在 $[a,n-a]$ 里面。</p>
<p>这样这道题就做完了，复杂度 $O(n+m)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> N = <span class="number">0xAE3803</span> - <span class="number">0xAA5100</span>;</span><br><span class="line"></span><br><span class="line">vector &lt;<span class="type">int</span>&gt; g[N], tr[N], st[N];</span><br><span class="line"><span class="type">int</span> n, m, dfn[N], low[N], _time, stk[N], stktop, nds, siz[N], col[N], ncnt[<span class="number">4</span>], nidx[<span class="number">4</span>], fa[N], ans[N], ctr;</span><br><span class="line"><span class="type">int</span> w[N], wsm[N], vis[N], dvp;</span><br><span class="line">queue &lt;<span class="type">int</span>&gt; que;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    n = <span class="built_in">qread</span>(); m = <span class="built_in">qread</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= <span class="number">3</span>;i++) ncnt[nidx[i] = i] = <span class="built_in">qread</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= m;i++) &#123;</span><br><span class="line">        <span class="type">int</span> u = <span class="built_in">qread</span>() + <span class="number">1</span>, v = <span class="built_in">qread</span>() + <span class="number">1</span>;</span><br><span class="line">        g[u].<span class="built_in">push_back</span>(v); g[v].<span class="built_in">push_back</span>(u);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Tarjan</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> fa)</span> </span>&#123;</span><br><span class="line">	dfn[u] = low[u] = ++_time;</span><br><span class="line">	stk[++stktop] = u;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> v : g[u]) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!dfn[v]) &#123;</span><br><span class="line">			<span class="built_in">Tarjan</span>(v, u);</span><br><span class="line">			low[u] = <span class="built_in">min</span>(low[u], low[v]);</span><br><span class="line">			<span class="keyword">if</span> (low[v] &gt;= dfn[u]) &#123;</span><br><span class="line">				nds++;</span><br><span class="line">				<span class="keyword">for</span> (;;) &#123;</span><br><span class="line">					<span class="type">int</span> x = stk[stktop];</span><br><span class="line">					stktop--;</span><br><span class="line">					tr[nds].<span class="built_in">push_back</span>(x);</span><br><span class="line">					tr[x].<span class="built_in">push_back</span>(nds);</span><br><span class="line">					<span class="comment">//cout &lt;&lt; x &lt;&lt; &quot;&lt;-&gt;&quot; &lt;&lt; nds &lt;&lt; endl;</span></span><br><span class="line">					<span class="keyword">if</span> (x == v) <span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				tr[u].<span class="built_in">push_back</span>(nds);</span><br><span class="line">				tr[nds].<span class="built_in">push_back</span>(u);</span><br><span class="line">				<span class="comment">//cout &lt;&lt; u &lt;&lt; &quot;&lt;-&gt;&quot; &lt;&lt; nds &lt;&lt; endl;</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (v != fa) low[u] = <span class="built_in">min</span>(low[u], dfn[v]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Dfs1</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> mxsz = <span class="number">0</span>;</span><br><span class="line">    siz[u] = (u &lt;= n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> v : tr[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (v != fa[u]) &#123;</span><br><span class="line">            fa[v] = u;</span><br><span class="line">            <span class="built_in">Dfs1</span>(v);</span><br><span class="line">            siz[u] += siz[v];</span><br><span class="line">            mxsz = <span class="built_in">max</span>(mxsz, siz[v]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    mxsz = <span class="built_in">max</span>(mxsz, n - siz[u]);</span><br><span class="line">    <span class="keyword">if</span> (mxsz &lt;= n / <span class="number">2</span>) ctr = u;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Dfs2</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> fa, <span class="type">int</span> c)</span> </span>&#123;</span><br><span class="line">    col[u] = c;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> v : tr[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (v != fa) <span class="built_in">Dfs2</span>(v, u, c);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Prefix</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    nds = n;</span><br><span class="line">    <span class="built_in">Tarjan</span>(<span class="number">1</span>, <span class="number">-1</span>);</span><br><span class="line">    <span class="built_in">sort</span>(nidx + <span class="number">1</span>, nidx + <span class="number">4</span>, [&amp;](<span class="type">const</span> <span class="type">int</span> &amp;x, <span class="type">const</span> <span class="type">int</span> &amp;y) &#123;</span><br><span class="line">        <span class="keyword">return</span> ncnt[x] &lt; ncnt[y];</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Dfs3</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">    vis[u] = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> v : g[u]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (vis[v] == <span class="number">1</span>) &#123;</span><br><span class="line">            st[u].<span class="built_in">push_back</span>(v);</span><br><span class="line">            <span class="built_in">Dfs3</span>(v);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Dfs4</span><span class="params">(<span class="type">int</span> u)</span> </span>&#123;</span><br><span class="line">    wsm[u] = w[u];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> v : st[u]) &#123;</span><br><span class="line">        <span class="built_in">Dfs4</span>(v); wsm[u] += wsm[v];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Dfs5</span><span class="params">(<span class="type">int</span> u, <span class="type">int</span> c)</span> </span>&#123;</span><br><span class="line">    col[u] = c;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> v : st[u]) <span class="built_in">Dfs5</span>(v, c);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Divide</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">Dfs1</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= nds;i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (siz[i] &gt;= ncnt[nidx[<span class="number">1</span>]] &amp;&amp; n - siz[i] &gt;= ncnt[nidx[<span class="number">2</span>]]) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>;j &lt;= n;j++) col[j] = nidx[<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">Dfs2</span>(i, fa[i], nidx[<span class="number">1</span>]);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (siz[i] &gt;= ncnt[nidx[<span class="number">2</span>]] &amp;&amp; n - siz[i] &gt;= ncnt[nidx[<span class="number">1</span>]]) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>;j &lt;= n;j++) col[j] = nidx[<span class="number">1</span>];</span><br><span class="line">            <span class="built_in">Dfs2</span>(i, fa[i], nidx[<span class="number">2</span>]);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (ctr &lt;= n) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> v : tr[ctr]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (v == fa[ctr]) w[v] = n - siz[ctr];</span><br><span class="line">        <span class="keyword">else</span> w[v] = siz[v];</span><br><span class="line">        vis[v] = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Dfs3</span>(fa[ctr]); <span class="built_in">Dfs4</span>(fa[ctr]);</span><br><span class="line">    <span class="type">bool</span> flg = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> v : tr[ctr]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (wsm[v] &gt;= ncnt[nidx[<span class="number">1</span>]] &amp;&amp; n - wsm[v] &gt;= ncnt[nidx[<span class="number">2</span>]]) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> v : tr[ctr]) col[v] = nidx[<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">Dfs5</span>(v, nidx[<span class="number">1</span>]);</span><br><span class="line">            flg = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (wsm[v] &gt;= ncnt[nidx[<span class="number">2</span>]] &amp;&amp; n - wsm[v] &gt;= ncnt[nidx[<span class="number">1</span>]]) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> v : tr[ctr]) col[v] = nidx[<span class="number">1</span>];</span><br><span class="line">            <span class="built_in">Dfs5</span>(v, nidx[<span class="number">2</span>]);</span><br><span class="line">            flg = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!flg) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> u : tr[ctr]) &#123;</span><br><span class="line">            <span class="type">int</span> mxs = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> v : st[u]) mxs = <span class="built_in">max</span>(mxs, wsm[v]);</span><br><span class="line">            <span class="keyword">if</span> (mxs &lt; ncnt[nidx[<span class="number">1</span>]] &amp;&amp; n - wsm[u] &lt; ncnt[nidx[<span class="number">1</span>]]) &#123;</span><br><span class="line">                <span class="type">int</span> ndc = st[u].<span class="built_in">size</span>();</span><br><span class="line">                <span class="type">int</span> cur = n - wsm[u];</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; ndc;i++) &#123;</span><br><span class="line">                    cur += wsm[st[u][i]];</span><br><span class="line">                    <span class="keyword">if</span> (cur &gt;= ncnt[nidx[<span class="number">1</span>]] &amp;&amp; n - cur &gt;= ncnt[nidx[<span class="number">2</span>]]) &#123;</span><br><span class="line">                        <span class="keyword">for</span> (<span class="type">int</span> v : tr[ctr]) col[v] = nidx[<span class="number">1</span>];</span><br><span class="line">                        col[u] = nidx[<span class="number">2</span>];</span><br><span class="line">                        <span class="keyword">for</span> (<span class="type">int</span> j = i + <span class="number">1</span>;j &lt; ndc;j++) <span class="built_in">Dfs5</span>(st[u][j], nidx[<span class="number">2</span>]);</span><br><span class="line">                        <span class="keyword">goto</span> done;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (cur &gt;= ncnt[nidx[<span class="number">2</span>]] &amp;&amp; n - cur &gt;= ncnt[nidx[<span class="number">1</span>]]) &#123;</span><br><span class="line">                        <span class="keyword">for</span> (<span class="type">int</span> v : tr[ctr]) col[v] = nidx[<span class="number">2</span>];</span><br><span class="line">                        col[u] = nidx[<span class="number">1</span>];</span><br><span class="line">                        <span class="keyword">for</span> (<span class="type">int</span> j = i + <span class="number">1</span>;j &lt; ndc;j++) <span class="built_in">Dfs5</span>(st[u][j], nidx[<span class="number">1</span>]);</span><br><span class="line">                        <span class="keyword">goto</span> done;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        done:;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> v : tr[ctr]) <span class="built_in">Dfs2</span>(v, ctr, col[v]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Bfs</span><span class="params">(<span class="type">int</span> cid)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (!que.<span class="built_in">empty</span>()) que.<span class="built_in">pop</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n;i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (col[i] == cid) &#123;</span><br><span class="line">            que.<span class="built_in">push</span>(i);</span><br><span class="line">            ans[i] = cid;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> tot = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (ncnt[cid] == <span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="type">int</span> u = que.<span class="built_in">front</span>();</span><br><span class="line">        que.<span class="built_in">pop</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> v : g[u]) &#123;</span><br><span class="line">            <span class="keyword">if</span> (col[v] == col[u] &amp;&amp; ans[v] == nidx[<span class="number">3</span>]) &#123;</span><br><span class="line">                ans[v] = cid;</span><br><span class="line">                tot++;</span><br><span class="line">                que.<span class="built_in">push</span>(v);</span><br><span class="line">                <span class="keyword">if</span> (tot == ncnt[cid]) <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">Solve</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (col[<span class="number">1</span>] == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n;i++) cout &lt;&lt; <span class="number">0</span> &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">        cout &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n;i++) ans[i] = nidx[<span class="number">3</span>];</span><br><span class="line">    <span class="built_in">Bfs</span>(nidx[<span class="number">1</span>]); <span class="built_in">Bfs</span>(nidx[<span class="number">2</span>]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>;i &lt;= n;i++) cout &lt;&lt; ans[i] &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://soly5tic.github.io/2023/09/10/solution-p5811/" data-id="cm6m8kxln001rd0vh7eyn7puf" data-title="洛谷 P5811 [IOI2019] 景点划分 题解" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
        <a href="/2023/09/10/solution-p5811/#comments" class="article-comment-link">
          <span class="post-comments-count valine-comment-count fa fa-comment" data-xid="/2023/09/10/solution-p5811/" itemprop="commentCount"></span>
          Comments
        </a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%A2%98%E8%A7%A3/" rel="tag">题解</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2023/10/08/solution-p9684/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          洛谷 P9684 Hello, Solitude. 题解
        
      </div>
    </a>
  
  
    <a href="/2023/08/16/uoj418-greedy-sorting-on-tree/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">uoj418（树上相邻交换）</div>
    </a>
  
</nav>

  
</article>



  <section id="comments" class="vcomment">

  </section>
</section>
        
          <aside id="sidebar">
  
      <div class="widget-wrap">
    <h3 class="widget-title">Friends</h3>
    <div class="widget">
      <ul>
        <li>
          <a target="_blank" rel="noopener" href="https://www.blog-e.top/">Blog-E</a>
        </li>
      </ul>
    </div>
  </div>
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%80%BB%E7%BB%93/" rel="tag">总结</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B4%E6%B4%BB/" rel="tag">整活</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B8%B8%E8%AE%B0/" rel="tag">游记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%A2%98%E8%A7%A3/" rel="tag">题解</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/%E6%80%BB%E7%BB%93/" style="font-size: 13.33px;">总结</a> <a href="/tags/%E6%95%B4%E6%B4%BB/" style="font-size: 10px;">整活</a> <a href="/tags/%E6%B8%B8%E8%AE%B0/" style="font-size: 16.67px;">游记</a> <a href="/tags/%E9%A2%98%E8%A7%A3/" style="font-size: 20px;">题解</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/12/">December 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/11/">November 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/10/">October 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/05/">May 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">February 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">January 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">December 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/10/">October 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/09/">September 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/08/">August 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">July 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/06/">June 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/12/29/icpc49-ecf/">第 49 届 ICPC EC Final 游记</a>
          </li>
        
          <li>
            <a href="/2024/12/01/icpc49-regional-km/">ICPC 昆明站游记</a>
          </li>
        
          <li>
            <a href="/2024/11/18/icpc49-regional-sh/">ICPC 上海站游记</a>
          </li>
        
          <li>
            <a href="/2024/11/09/ccpc10-regional-cq/">CCPC 重庆站游记</a>
          </li>
        
          <li>
            <a href="/2024/10/15/ucup3-s12/">The 3rd Universal Cup Stage 12 记录</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    <div class="widget-wrap">
    <h3 class="widget-title">Page Views</h3>
          <img src="https://badges.toozhao.com/badges/01HN5MV9JDS57RZF30YTKM0DVY/green.svg" alt="Page Views Count">
  </div>
  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 Sol 1<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  
<script src="https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js"></script>

<script>
    var GUEST_INFO = ['nick','mail','link'];
    var guest_info = 'nick,mail,link'.split(',').filter(function(item){
        return GUEST_INFO.indexOf(item) > -1
    });
    var notify = 'false' == true;
    var verify = 'false' == true;
    new Valine({
        el: '.vcomment',
        notify: notify,
        verify: verify,
        appId: "eCOqy671NBhdnqpII5jCnb9f-gzGzoHsz",
        appKey: "OWLPWcS3Bjm5x1YJG144u61I",
        placeholder: "Just go go",
        pageSize:'10',
        avatar:'mm',
        lang:'zh-cn'
    });
</script>

  </div>
</body>
</html>